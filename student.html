<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CramNerd | Student Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #6c5ce7;
            --secondary-color: #a29bfe;
            --accent-color: #fd79a8;
            --dark-color: #2d3436;
            --light-color: #f5f6fa;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --danger-color: #d63031;
            --info-color: #0984e3;
            --shadow: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff;
            --shadow-inset: inset 4px 4px 8px #d1d9e6, inset -4px -4px 8px #ffffff;
            --border-radius: 15px;
            --transition: all 0.3s ease;
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            min-height: 100vh;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .greeting h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .greeting p {
            font-size: 0.9rem;
            color: #636e72;
        }

        .notification {
            position: relative;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--glass-border);
        }

        .notification i {
            color: var(--dark-color);
            font-size: 1.2rem;
        }

        .notification-dot {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background-color: #e74c3c;
            border-radius: 50%;
            border: 2px solid var(--glass-bg);
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            border: 1px solid var(--glass-border);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .card-icon.blue {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        }

        .card-icon.purple {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
        }

        .card-icon.green {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
        }

        .card-icon.orange {
            background: linear-gradient(135deg, #fab1a0 0%, #e17055 100%);
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-description {
            font-size: 0.8rem;
            color: #636e72;
        }

        .upcoming-classes {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary-color);
        }

        .class-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .class-item:last-child {
            border-bottom: none;
        }

        .class-time {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 8px 12px;
            margin-right: 15px;
            text-align: center;
            min-width: 80px;
        }

        .class-time .time {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .class-time .duration {
            font-size: 0.7rem;
            color: #636e72;
        }

        .class-info {
            flex: 1;
        }

        .class-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .class-teacher {
            font-size: 0.8rem;
            color: #636e72;
        }

        .class-link {
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #636e72;
            text-decoration: none;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-item.active {
            color: var(--primary-color);
            transform: translateY(-5px);
        }

        .nav-item.active .nav-icon {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
        }

        .nav-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .asnat-icon {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 50%, #6c5ce7 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
            position: relative;
            overflow: hidden;
        }

        .asnat-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, transparent, transparent, #ffffff);
            animation: rotate 4s linear infinite;
        }

        .asnat-icon::after {
            content: '';
            position: absolute;
            inset: 3px;
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 50%, #6c5ce7 100%);
            border-radius: 50%;
        }

        .asnat-icon i {
            position: relative;
            z-index: 1;
        }

        /* Frame styles */
        .frame-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 80px;
            display: none;
            z-index: 90;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            overflow-y: auto;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Notification styles */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            max-width: 90%;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            position: relative;
            padding: 16px 20px;
            border-radius: var(--border-radius);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transform: translateX(120%);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            opacity: 0;
            overflow: hidden;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.hide {
            transform: translateX(120%);
            opacity: 0;
        }

        .notification.success {
            background-color: var(--success-color);
        }

        .notification.error {
            background-color: var(--danger-color);
        }

        .notification.warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .notification.info {
            background-color: var(--info-color);
        }

        .notification-icon {
            margin-right: 12px;
            font-size: 20px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 14px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            margin-left: 15px;
            font-size: 18px;
            opacity: 0.8;
            transition: var(--transition);
        }

        .notification-close:hover {
            opacity: 1;
        }

        .notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.3);
            width: 100%;
        }

        .notification-progress-bar {
            height: 100%;
            background-color: white;
            width: 100%;
            transition: width linear;
        }

        /* Asnat Chat Interface */
        .asnat-chat-container {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 350px;
            max-width: 90%;
            max-height: 500px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--glass-border);
            display: none;
            flex-direction: column;
            z-index: 999;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .asnat-chat-header {
            padding: 15px;
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 50%, #6c5ce7 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .asnat-chat-title {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .asnat-voice-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
        }

        .asnat-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .asnat-chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .asnat-message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .asnat-message b {
            font-weight: 600;
        }

        .asnat-user-message {
            align-self: flex-end;
            background-color: var(--primary-color);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .asnat-bot-message {
            align-self: flex-start;
            background-color: #f1f1f1;
            color: var(--dark-color);
            border-bottom-left-radius: 5px;
        }

        .asnat-chat-input-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.3);
        }

        .asnat-chat-input {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.8);
            outline: none;
            font-size: 0.9rem;
        }

        .asnat-send-btn {
            margin-left: 10px;
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 50%, #6c5ce7 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .asnat-send-btn:hover {
            transform: scale(1.05);
        }

        .asnat-typing-indicator {
            display: none;
            padding: 5px 15px;
            font-size: 0.8rem;
            color: #636e72;
        }

        /* Processing stages styles */
        .asnat-processing-stage {
            display: none;
            padding: 5px 15px;
            font-size: 0.8rem;
            color: #636e72;
            font-style: italic;
        }

        /* Image message styles */
        .asnat-image-message {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .asnat-image-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .asnat-image-caption {
            font-size: 0.8rem;
            color: #636e72;
            text-align: center;
        }

        /* Animation for speaking */
        @keyframes speaking {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .speaking {
            animation: speaking 0.8s infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .cards-container {
                grid-template-columns: 1fr;
            }
            
            .greeting h1 {
                font-size: 1.2rem;
            }

            .asnat-chat-container {
                width: 90%;
                right: 5%;
                bottom: 90px;
                max-height: 60vh;
            }
        }
    </style>
</head>
<body>
    <!-- Main Dashboard Content -->
    <div id="dashboard-content">
        <div class="container">
            <header>
                <div class="profile">
                    <img id="user-avatar" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Profile" class="profile-img">
                    <div class="greeting">
                        <h1 id="welcome-message">Good Morning, Student!</h1>
                        <p id="status-message">Loading your dashboard...</p>
                    </div>
                </div>
                <div class="notification">
                    <i class="fas fa-bell"></i>
                    <span class="notification-dot"></span>
                </div>
            </header>

            <div class="cards-container">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon blue">
                            <i class="fas fa-book-open"></i>
                        </div>
                    </div>
                    <div class="card-value" id="active-courses">0</div>
                    <div class="card-title">Active Courses</div>
                    <div class="card-description" id="courses-description">Loading...</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon purple">
                            <i class="fas fa-tasks"></i>
                        </div>
                    </div>
                    <div class="card-value" id="pending-tasks">0</div>
                    <div class="card-title">Pending Tasks</div>
                    <div class="card-description" id="tasks-description">Loading...</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon green">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="card-value" id="attendance">0%</div>
                    <div class="card-title">Attendance</div>
                    <div class="card-description" id="attendance-description">Loading...</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon orange">
                            <i class="fas fa-comments"></i>
                        </div>
                    </div>
                    <div class="card-value" id="new-messages">0</div>
                    <div class="card-title">New Messages</div>
                    <div class="card-description" id="messages-description">Loading...</div>
                </div>
            </div>

            <div class="upcoming-classes">
                <h2 class="section-title">
                    <i class="fas fa-calendar-alt"></i>
                    Upcoming Classes
                </h2>
                
                <div id="classes-list">
                    <div class="class-item">
                        <div class="class-time">
                            <div class="time">--:--</div>
                            <div class="duration">-- min</div>
                        </div>
                        <div class="class-info">
                            <div class="class-name">Loading classes...</div>
                            <div class="class-teacher">Please wait</div>
                        </div>
                        <a href="#" class="class-link">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Frame containers for each section -->
        <div class="frame-container" id="coursework-frame">
            <iframe src="notes.html"></iframe>
        </div>

        <div class="frame-container" id="assessment-frame">
            <iframe src="files.html"></iframe>
        </div>

        <div class="frame-container" id="chat-frame">
            <iframe src="connect.html"></iframe>
        </div>

        <!-- Notification Container -->
        <div class="notification-container" id="notification-container"></div>

        <!-- Asnat Chat Interface -->
        <div class="asnat-chat-container" id="asnat-chat">
            <div class="asnat-chat-header">
                <div class="asnat-chat-title">
                    Asnat Assistant
                    <button class="asnat-voice-toggle" id="asnat-voice-toggle" title="Toggle voice">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
                <button class="asnat-close-btn" id="asnat-close-btn">&times;</button>
            </div>
            <div class="asnat-chat-messages" id="asnat-messages">
                <div class="asnat-message asnat-bot-message">
                    Hello! I'm Asnat, your AI assistant. How can I help you today?
                </div>
            </div>
            <div class="asnat-typing-indicator" id="asnat-typing">Asnat is typing...</div>
            <div class="asnat-processing-stage" id="asnat-thinking">Asnat is thinking...</div>
            <div class="asnat-processing-stage" id="asnat-analysing">Asnat is analysing...</div>
            <div class="asnat-processing-stage" id="asnat-processing">Asnat is processing...</div>
            <div class="asnat-chat-input-container">
                <input type="text" class="asnat-chat-input" id="asnat-input" placeholder="Type your message...">
                <button class="asnat-send-btn" id="asnat-send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <nav class="bottom-nav">
            <a href="#" class="nav-item active" id="dashboard-nav">
                <div class="nav-icon">
                    <i class="fas fa-home"></i>
                </div>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" id="coursework-nav">
                <div class="nav-icon">
                    <i class="fas fa-book"></i>
                </div>
                <span>Coursework</span>
            </a>
            <a href="#" class="nav-item asnat-item" id="asnat-nav">
                <div class="nav-icon asnat-icon">
                    <i class="fas fa-comment-dots"></i>
                </div>
                <span>Asnat</span>
            </a>
            <a href="#" class="nav-item" id="assessment-nav">
                <div class="nav-icon">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <span>Assessment</span>
            </a>
            <a href="#" class="nav-item" id="chat-nav">
                <div class="nav-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <span>Chat</span>
            </a>
        </nav>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAkrHsyfCTijqKP7UJv0eSx0iNvl8S06U8",
            authDomain: "sms-single.firebaseapp.com",
            projectId: "sms-single",
            storageBucket: "sms-single.appspot.com",
            messagingSenderId: "140188895278",
            appId: "1:140188895278:web:1b56660a13e5b088ce77bf",
            measurementId: "G-7ER348P6VZ"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // DOM Elements
        const dashboardContent = document.getElementById('dashboard-content');
        const welcomeMessage = document.getElementById('welcome-message');
        const statusMessage = document.getElementById('status-message');
        const userAvatar = document.getElementById('user-avatar');
        const activeCourses = document.getElementById('active-courses');
        const pendingTasks = document.getElementById('pending-tasks');
        const attendance = document.getElementById('attendance');
        const newMessages = document.getElementById('new-messages');
        const coursesDescription = document.getElementById('courses-description');
        const tasksDescription = document.getElementById('tasks-description');
        const attendanceDescription = document.getElementById('attendance-description');
        const messagesDescription = document.getElementById('messages-description');
        const classesList = document.getElementById('classes-list');
        const notificationContainer = document.getElementById('notification-container');
        
        // Asnat Chat Elements
        const asnatChat = document.getElementById('asnat-chat');
        const asnatMessages = document.getElementById('asnat-messages');
        const asnatInput = document.getElementById('asnat-input');
        const asnatSendBtn = document.getElementById('asnat-send-btn');
        const asnatCloseBtn = document.getElementById('asnat-close-btn');
        const asnatTypingIndicator = document.getElementById('asnat-typing');
        const asnatThinkingIndicator = document.getElementById('asnat-thinking');
        const asnatAnalysingIndicator = document.getElementById('asnat-analysing');
        const asnatProcessingIndicator = document.getElementById('asnat-processing');
        const asnatVoiceToggle = document.getElementById('asnat-voice-toggle');
        const asnatIcon = document.querySelector('.asnat-icon');
        
        // Gemini API Configuration
        const GEMINI_API_KEY = "AIzaSyDk--g_AuzkKWCrR3rf8LD4OwYbbWS4IQo";
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${GEMINI_API_KEY}`;
        
        // Speech synthesis
        const speechSynthesis = window.speechSynthesis;
        let isVoiceEnabled = true;
        let currentUtterance = null;
        let currentUserName = "Student"; // Default name
        
        // System prompt to ensure Asnat knows its identity
        const systemPrompt = {
            role: "user",
            parts: [{
                text: "You are Asnat, an AI assistant for the CramNerd educational platform. Your name is Asnat (pronounced As-nat). You are helpful, friendly, and knowledgeable about educational topics. Always remember your name is Asnat and you were created to assist students with their academic needs. When asked about your name or identity, respond clearly that you are Asnat, the AI assistant for CramNerd. IMPORTANT: Never use asterisks (*) or hash symbols (#) in your responses. Instead, use bold text formatting only when necessary. You can generate images when requested by providing image URLs that are relevant to the educational context."
            }]
        };
        
        const systemResponse = {
            role: "model",
            parts: [{
                text: "Understood. I am Asnat, the AI assistant for CramNerd. I'm here to help students with their academic needs, answer questions, provide guidance, and assist with their educational journey. I'll always remember my name is Asnat and my purpose is to be a helpful educational assistant. I will not use asterisks or hash symbols in my responses and will generate relevant images when appropriate."
            }]
        };
        
        // Chat history for context
        let chatHistory = [systemPrompt, systemResponse];
        
        // Firebase references
        const credentialsRef = ref(db, 'credentials');
        const studentsRef = ref(db, 'students');
        const teachersRef = ref(db, 'teachers');
        const oldStudentsRef = ref(db, 'oldStudents');
        
        // Motivational quotes for Asnat's greeting
        const motivationalQuotes = [
            "Every small step you take is progress. Keep going!",
            "Believe in yourself and all that you are. You're capable of amazing things!",
            "Success is the sum of small efforts repeated daily. Keep pushing forward!",
            "You're braver than you believe, stronger than you seem, and smarter than you think!",
            "The expert in anything was once a beginner. Keep learning and growing!",
            "Your education is a dress rehearsal for a life that is yours to lead. Make it count!",
            "Don't watch the clock; do what it does. Keep going!",
            "The secret of getting ahead is getting started. You're doing great!",
            "You don't have to be perfect to be amazing. Just keep improving!",
            "The future belongs to those who believe in the beauty of their dreams. Keep dreaming big!"
        ];
        
        // Enhanced Notification System
        function showNotification({ title, message, type = 'info', duration = 5000 }) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const iconMap = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            
            notification.innerHTML = `
                <i class="fas fa-${iconMap[type]} notification-icon"></i>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close">&times;</button>
                <div class="notification-progress">
                    <div class="notification-progress-bar" style="width: 100%"></div>
                </div>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Trigger reflow to enable animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto-dismiss after duration
            let timeoutId;
            if (duration > 0) {
                const progressBar = notification.querySelector('.notification-progress-bar');
                progressBar.style.transition = `width ${duration}ms linear`;
                progressBar.style.width = '0%';
                
                timeoutId = setTimeout(() => {
                    notification.classList.remove('show');
                    notification.classList.add('hide');
                    
                    // Remove after animation completes
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, duration);
            }
            
            // Close button handler
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => {
                clearTimeout(timeoutId);
                notification.classList.remove('show');
                notification.classList.add('hide');
                
                setTimeout(() => {
                    notification.remove();
                }, 300);
            });
            
            return notification;
        }
        
        // Save user data to localStorage
        function saveUserData(userId, userType, userData) {
            localStorage.setItem('currentUser', JSON.stringify({
                userId: userId,
                userType: userType,
                lastLogin: Date.now(),
                userData: userData
            }));
        }
        
        // Get device fingerprint
        function getDeviceFingerprint() {
            try {
                const fingerprint = {
                    userAgent: navigator.userAgent,
                    screenResolution: `${window.screen.width}x${window.screen.height}`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    language: navigator.language,
                    cookiesEnabled: navigator.cookieEnabled,
                    platform: navigator.platform
                };
                
                return fingerprint;
            } catch (error) {
                console.error('Error getting device fingerprint:', error);
                return null;
            }
        }
        
        // Find student by device info
        async function findStudentByDeviceInfo() {
            try {
                // Get current device info
                const currentFingerprint = getDeviceFingerprint();
                if (!currentFingerprint) return null;
                
                // Get all credentials
                const credentialsSnapshot = await get(credentialsRef);
                if (!credentialsSnapshot.exists()) {
                    throw new Error('No credentials found');
                }
                
                const credentials = credentialsSnapshot.val();
                
                // Find matching credential based on device info
                for (const [userId, credential] of Object.entries(credentials)) {
                    if (credential.deviceInfo && credential.userType === 'student') {
                        // Compare key device info properties
                        const deviceMatch = 
                            credential.deviceInfo.userAgent === currentFingerprint.userAgent &&
                            credential.deviceInfo.platform === currentFingerprint.platform;
                        
                        if (deviceMatch) {
                            return userId;
                        }
                    }
                }
                
                return null;
            } catch (error) {
                console.error('Error finding student by device info:', error);
                throw error;
            }
        }
        
        // Load student data
        async function loadStudentData(userId) {
            try {
                // Get student data from both students and oldStudents collections
                const studentRef = ref(db, `students/${userId}`);
                const oldStudentRef = ref(db, `oldStudents/${userId}`);
                
                const [studentSnapshot, oldStudentSnapshot] = await Promise.all([
                    get(studentRef),
                    get(oldStudentRef)
                ]);
                
                let studentData = null;
                let isOldStudent = false;
                
                if (studentSnapshot.exists()) {
                    studentData = studentSnapshot.val();
                } else if (oldStudentSnapshot.exists()) {
                    studentData = oldStudentSnapshot.val();
                    isOldStudent = true;
                } else {
                    throw new Error('Student record not found');
                }
                
                // Update current user name
                currentUserName = studentData.name || 'Student';
                
                // Update UI with student data
                const greeting = getGreeting();
                welcomeMessage.textContent = `${greeting}, ${currentUserName}`;
                statusMessage.textContent = studentData.status === 'Active' ? 
                    'Your account is active' : 
                    `Account status: ${studentData.status || 'Unknown'}`;
                
                // Set avatar if available
                if (studentData.profileImage) {
                    userAvatar.src = studentData.profileImage;
                } else if (studentData.avatar) {
                    userAvatar.src = studentData.avatar;
                }
                
                // Get class information for the student
                const classId = studentData.class;
                let className = '';
                let classRefPath = isOldStudent ? `oldStudents/classes/${classId}` : `classes/${classId}`;
                
                if (classId) {
                    const classRef = ref(db, classRefPath);
                    const classSnapshot = await get(classRef);
                    if (classSnapshot.exists()) {
                        const classData = classSnapshot.val();
                        className = classData.name || '';
                    }
                }
                
                // Update stats
                // Active courses - using the student's class as a course for this example
                activeCourses.textContent = className ? '1' : '0';
                coursesDescription.textContent = className ? `Currently in ${className}` : 'No active courses';
                
                // Pending tasks - using a default value for this example
                pendingTasks.textContent = '3';
                tasksDescription.textContent = '3 due soon';
                
                // Attendance - calculate from attendance records
                let attendanceRate = 0;
                if (classId && !isOldStudent) {
                    const attendanceRef = ref(db, `attendance/${classId}`);
                    const attendanceSnapshot = await get(attendanceRef);
                    if (attendanceSnapshot.exists()) {
                        const attendanceData = attendanceSnapshot.val();
                        let presentDays = 0;
                        let totalDays = 0;
                        
                        for (const date in attendanceData) {
                            if (attendanceData[date][userId]) {
                                totalDays++;
                                if (attendanceData[date][userId].status === 'present') {
                                    presentDays++;
                                }
                            }
                        }
                        
                        if (totalDays > 0) {
                            attendanceRate = Math.round((presentDays / totalDays) * 100);
                        }
                    }
                }
                
                attendance.textContent = `${attendanceRate}%`;
                attendanceDescription.textContent = attendanceRate > 75 ? 'Good job!' : 
                                                  attendanceRate > 50 ? 'Keep it up!' : 
                                                  isOldStudent ? 'Graduated' : 'Needs improvement';
                
                // New messages - using a default value for this example
                newMessages.textContent = '2';
                messagesDescription.textContent = '2 new messages';
                
                // Load upcoming classes - using the student's subjects
                if (classId && !isOldStudent) {
                    const subjectsRef = ref(db, 'subjects');
                    const subjectsSnapshot = await get(subjectsRef);
                    
                    if (subjectsSnapshot.exists()) {
                        const subjectsData = subjectsSnapshot.val();
                        const studentSubjects = Object.values(subjectsData).filter(
                            subject => subject.class === classId
                        );
                        
                        classesList.innerHTML = '';
                        
                        if (studentSubjects.length === 0) {
                            classesList.innerHTML = `
                                <div class="class-item">
                                    <div class="class-info">
                                        <div class="class-name">No upcoming classes scheduled</div>
                                        <div class="class-teacher">Check back later</div>
                                    </div>
                                </div>
                            `;
                        } else {
                            // Display the first 3 subjects as upcoming classes
                            studentSubjects.slice(0, 3).forEach(subject => {
                                const classItem = document.createElement('div');
                                classItem.className = 'class-item';
                                classItem.innerHTML = `
                                    <div class="class-time">
                                        <div class="time">${subject.schedule?.time?.from || '--:--'}</div>
                                        <div class="duration">60 min</div>
                                    </div>
                                    <div class="class-info">
                                        <div class="class-name">${subject.name || 'Subject'}</div>
                                        <div class="class-teacher">${subject.teacher || 'Teacher'}</div>
                                    </div>
                                    <a href="#" class="class-link">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                `;
                                classesList.appendChild(classItem);
                            });
                        }
                    }
                } else if (isOldStudent) {
                    classesList.innerHTML = `
                        <div class="class-item">
                            <div class="class-info">
                                <div class="class-name">Graduated Student</div>
                                <div class="class-teacher">No current classes</div>
                            </div>
                        </div>
                    `;
                }
                
                // Set up real-time updates for attendance if not old student
                if (classId && !isOldStudent) {
                    const attendanceRef = ref(db, `attendance/${classId}`);
                    onValue(attendanceRef, (snapshot) => {
                        const attendanceData = snapshot.val();
                        if (attendanceData) {
                            let presentDays = 0;
                            let totalDays = 0;
                            
                            for (const date in attendanceData) {
                                if (attendanceData[date][userId]) {
                                    totalDays++;
                                    if (attendanceData[date][userId].status === 'present') {
                                        presentDays++;
                                    }
                                }
                            }
                            
                            if (totalDays > 0) {
                                const newRate = Math.round((presentDays / totalDays) * 100);
                                attendance.textContent = `${newRate}%`;
                                attendanceDescription.textContent = newRate > 75 ? 'Good job!' : 
                                                                   newRate > 50 ? 'Keep it up!' : 
                                                                   'Needs improvement';
                            }
                        }
                    });
                }
                
                // Save user data to localStorage
                saveUserData(userId, isOldStudent ? 'oldStudent' : 'student', studentData);
                
                // Update Asnat's welcome message with user's name
                updateAsnatWelcomeMessage(currentUserName);
                
                // Show welcome notification
                showNotification({
                    title: 'Welcome to CramNerd',
                    message: `Your ${isOldStudent ? 'alumni' : 'student'} dashboard is ready`,
                    type: 'success',
                    duration: 3000
                });
                
            } catch (error) {
                console.error('Error loading student data:', error);
                showNotification({
                    title: 'Error',
                    message: 'Failed to load student data: ' + error.message,
                    type: 'error'
                });
            }
        }
        
        // Update Asnat's welcome message with user's name
        function updateAsnatWelcomeMessage(userName) {
            const welcomeMessages = [
                `Hello ${userName}! I'm Asnat, your AI assistant. How can I help you today?`,
                `Hi there ${userName}! I'm Asnat, ready to assist you with your studies.`,
                `Welcome back ${userName}! How can I assist you today?`,
                `Good day ${userName}! I'm Asnat, your learning companion. What can I do for you?`
            ];
            
            // Select a random welcome message
            const randomMessage = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
            
            // Update the chat history
            chatHistory = [systemPrompt, systemResponse, {
                role: "model",
                parts: [{ text: randomMessage }]
            }];
            
            // Update the UI if chat is open
            if (asnatMessages) {
                asnatMessages.innerHTML = `
                    <div class="asnat-message asnat-bot-message">
                        ${randomMessage}
                    </div>
                `;
            }
        }
        
        // Helper function to get time-based greeting
        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return 'Good Morning';
            if (hour < 18) return 'Good Afternoon';
            return 'Good Evening';
        }
        
        // Frame management functions
        function openFrame(frameId) {
            // Hide all frames first
            document.querySelectorAll('.frame-container').forEach(frame => {
                frame.style.display = 'none';
            });
            
            // Show the requested frame
            const frame = document.getElementById(frameId);
            if (frame) {
                frame.style.display = 'block';
            }
        }
        
        // Remove all asterisks from text while preserving intended formatting
        function removeAsterisks(text) {
            if (!text || typeof text !== 'string') return text;
            
            // Replace bold formatting patterns with HTML tags
            let processedText = text
                .replace(/\*\*\*(.*?)\*\*\*/g, '<b>$1</b>')  // Triple asterisks for bold
                .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')      // Double asterisks for bold
                .replace(/\*(.*?)\*/g, '<b>$1</b>')          // Single asterisks for bold
                .replace(/\*/g, '')                          // Remove any remaining asterisks
                .replace(/#/g, '');                          // Remove any hash symbols
            
            return processedText;
        }
        
        // Add a message to the Asnat chat
        function addAsnatMessage(message, isUser = false) {
            const messageElement = document.createElement('div');
            messageElement.className = `asnat-message ${isUser ? 'asnat-user-message' : 'asnat-bot-message'}`;
            
            // Check if message contains image URLs
            const imageUrls = extractImageUrls(message);
            
            if (imageUrls.length > 0) {
                // Create a container for message and images
                const container = document.createElement('div');
                
                // Process text (remove image URLs and remove asterisks)
                let processedText = message;
                imageUrls.forEach(url => {
                    processedText = processedText.replace(url, '');
                });
                processedText = removeAsterisks(processedText).trim();
                
                if (processedText) {
                    container.innerHTML = processedText;
                }
                
                // Add images
                imageUrls.forEach(url => {
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'asnat-image-container';
                    
                    const img = document.createElement('img');
                    img.src = url;
                    img.className = 'asnat-image-message';
                    img.alt = 'Image from Asnat';
                    img.loading = 'lazy';
                    
                    imageContainer.appendChild(img);
                    container.appendChild(imageContainer);
                });
                
                messageElement.appendChild(container);
            } else {
                // Remove all asterisks from the message
                const cleanMessage = removeAsterisks(message);
                messageElement.innerHTML = cleanMessage;
            }
            
            asnatMessages.appendChild(messageElement);
            asnatMessages.scrollTop = asnatMessages.scrollHeight;
        }
        
        // Extract image URLs from message
        function extractImageUrls(text) {
            const urlRegex = /(https?:\/\/[^\s]+\.(?:jpg|jpeg|png|gif|webp))/gi;
            return text.match(urlRegex) || [];
        }
        
        // Speak text using speech synthesis
        function speakText(text) {
            if (!isVoiceEnabled || !speechSynthesis) return;
            
            // Cancel any ongoing speech
            speechSynthesis.cancel();
            
            // Remove image URLs and formatting from text to be spoken
            let textToSpeak = text.replace(/(https?:\/\/[^\s]+\.(?:jpg|jpeg|png|gif|webp))/gi, '');
            textToSpeak = removeAsterisks(textToSpeak).replace(/<[^>]*>/g, '');
            
            // Create a new utterance
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            
            // Configure voice (try to find a female voice)
            const voices = speechSynthesis.getVoices();
            const preferredVoices = voices.filter(voice => 
                voice.name.includes('Female') || 
                voice.name.includes('Woman') || 
                voice.name.includes('female')
            );
            
            if (preferredVoices.length > 0) {
                utterance.voice = preferredVoices[0];
            } else if (voices.length > 0) {
                utterance.voice = voices[0];
            }
            
            utterance.rate = 1;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            // Start speaking animation
            asnatIcon.classList.add('speaking');
            
            // Event handlers
            utterance.onstart = () => {
                currentUtterance = utterance;
            };
            
            utterance.onend = utterance.onerror = () => {
                if (currentUtterance === utterance) {
                    currentUtterance = null;
                    asnatIcon.classList.remove('speaking');
                }
            };
            
            // Speak the text
            speechSynthesis.speak(utterance);
        }
        
        // Speak motivational quote
        function speakMotivationalQuote() {
            if (!isVoiceEnabled || !speechSynthesis) return;
            
            const randomQuote = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
            const greeting = getGreeting();
            const fullMessage = `${greeting} ${currentUserName}! ${randomQuote}`;
            
            speakText(fullMessage);
        }
        
        // Toggle voice on/off
        function toggleVoice() {
            isVoiceEnabled = !isVoiceEnabled;
            
            if (!isVoiceEnabled && currentUtterance) {
                speechSynthesis.cancel();
                asnatIcon.classList.remove('speaking');
            }
            
            // Update icon
            asnatVoiceToggle.innerHTML = `<i class="fas fa-volume-${isVoiceEnabled ? 'up' : 'mute'}"></i>`;
            asnatVoiceToggle.title = isVoiceEnabled ? 'Mute voice' : 'Unmute voice';
            
            // Show notification
            showNotification({
                title: 'Voice',
                message: `Voice ${isVoiceEnabled ? 'enabled' : 'disabled'}`,
                type: 'info',
                duration: 2000
            });
        }
        
        // Show processing stages
        async function showProcessingStages() {
            asnatThinkingIndicator.style.display = 'block';
            asnatMessages.scrollTop = asnatMessages.scrollHeight;
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            asnatThinkingIndicator.style.display = 'none';
            asnatAnalysingIndicator.style.display = 'block';
            asnatMessages.scrollTop = asnatMessages.scrollHeight;
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            asnatAnalysingIndicator.style.display = 'none';
            asnatProcessingIndicator.style.display = 'block';
            asnatMessages.scrollTop = asnatMessages.scrollHeight;
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            asnatProcessingIndicator.style.display = 'none';
            asnatTypingIndicator.style.display = 'block';
            asnatMessages.scrollTop = asnatMessages.scrollHeight;
        }
        
        // Generate response using Gemini API
        async function generateGeminiResponse(userMessage) {
            try {
                // Add user message to chat history
                chatHistory.push({
                    role: "user",
                    parts: [{ text: userMessage }]
                });
                
                // Show processing stages
                await showProcessingStages();
                
                // Call Gemini API
                const response = await fetch(GEMINI_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        contents: chatHistory,
                        generationConfig: {
                            temperature: 0.9,
                            topK: 1,
                            topP: 1,
                            maxOutputTokens: 2048,
                            stopSequences: []
                        },
                        safetySettings: [
                            {
                                category: "HARM_CATEGORY_HARASSMENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_HATE_SPEECH",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            }
                        ]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const data = await response.json();
                
                // Extract the response text
                let responseText = "I'm sorry, I couldn't process your request. Please try again.";
                if (data.candidates && data.candidates[0].content.parts) {
                    responseText = data.candidates[0].content.parts[0].text;
                }
                
                // Remove all asterisks from the response
                responseText = removeAsterisks(responseText);
                
                // Add bot response to chat history
                chatHistory.push({
                    role: "model",
                    parts: [{ text: responseText }]
                });
                
                // Hide typing indicator and add bot response
                asnatTypingIndicator.style.display = 'none';
                addAsnatMessage(responseText);
                
                // Speak the response
                speakText(responseText);
                
                return responseText;
            } catch (error) {
                console.error('Error generating Gemini response:', error);
                asnatTypingIndicator.style.display = 'none';
                asnatThinkingIndicator.style.display = 'none';
                asnatAnalysingIndicator.style.display = 'none';
                asnatProcessingIndicator.style.display = 'none';
                
                // Add error message to chat
                const errorMessage = "Sorry, I'm having trouble responding right now. Please try again later.";
                addAsnatMessage(errorMessage);
                
                // Add error message to chat history
                chatHistory.push({
                    role: "model",
                    parts: [{ text: errorMessage }]
                });
                
                throw error;
            }
        }
        
        // Handle Asnat chat input
        async function handleAsnatInput() {
            const message = asnatInput.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addAsnatMessage(message, true);
            asnatInput.value = '';
            
            try {
                // Generate response using Gemini API
                await generateGeminiResponse(message);
            } catch (error) {
                console.error('Error in Asnat chat:', error);
            }
        }
        
        // Toggle Asnat chat visibility
        function toggleAsnatChat() {
            if (asnatChat.style.display === 'flex') {
                asnatChat.style.display = 'none';
            } else {
                asnatChat.style.display = 'flex';
                asnatInput.focus();
            }
        }
        
        // Navigation event listeners
        document.getElementById('coursework-nav').addEventListener('click', function(e) {
            e.preventDefault();
            openFrame('coursework-frame');
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
        });
        
        document.getElementById('assessment-nav').addEventListener('click', function(e) {
            e.preventDefault();
            openFrame('assessment-frame');
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
        });
        
        document.getElementById('chat-nav').addEventListener('click', function(e) {
            e.preventDefault();
            openFrame('chat-frame');
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
        });
        
        document.getElementById('dashboard-nav').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelectorAll('.frame-container').forEach(frame => {
                frame.style.display = 'none';
            });
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
        });
        
        // Asnat assistant
        document.getElementById('asnat-nav').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
            toggleAsnatChat();
        });
        
        // Asnat chat event listeners
        asnatSendBtn.addEventListener('click', handleAsnatInput);
        asnatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleAsnatInput();
            }
        });
        asnatCloseBtn.addEventListener('click', toggleAsnatChat);
        asnatVoiceToggle.addEventListener('click', toggleVoice);
        
        // Notification bell
        document.querySelector('.notification').addEventListener('click', function() {
            showNotification({
                title: 'Notifications',
                message: 'You have new notifications',
                type: 'info'
            });
            this.querySelector('.notification-dot').style.display = 'none';
        });
        
        // Card hover effects
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Load voices for speech synthesis
                if (speechSynthesis) {
                    speechSynthesis.onvoiceschanged = () => {
                        // Voices are loaded
                    };
                }
                
                // Show Asnat chat immediately with greeting
                asnatChat.style.display = 'flex';
                
                // First try to find student by device info
                const studentId = await findStudentByDeviceInfo();
                
                if (studentId) {
                    // Found student by device info, load their dashboard
                    await loadStudentData(studentId);
                    
                    // Speak motivational quote after a short delay
                    setTimeout(() => {
                        speakMotivationalQuote();
                    }, 1500);
                } else {
                    // Check for existing user in localStorage
                    const currentUser = localStorage.getItem('currentUser');
                    
                    if (currentUser) {
                        const user = JSON.parse(currentUser);
                        // Verify the user is still valid
                        const credentialRef = ref(db, `credentials/${user.userId}`);
                        const credentialSnapshot = await get(credentialRef);
                        
                        if (credentialSnapshot.exists()) {
                            // User is valid, load their dashboard
                            await loadStudentData(user.userId);
                            
                            // Speak motivational quote after a short delay
                            setTimeout(() => {
                                speakMotivationalQuote();
                            }, 1500);
                        } else {
                            // User no longer exists, show error
                            showNotification({
                                title: 'Session Expired',
                                message: 'Please sign in again',
                                type: 'error'
                            });
                        }
                    } else {
                        // No user found, show sign-in required message
                        welcomeMessage.textContent = 'Welcome to CramNerd';
                        statusMessage.textContent = 'Please sign in to access your dashboard';
                        dashboardContent.style.display = 'block';
                        
                        // Clear demo data
                        activeCourses.textContent = '0';
                        coursesDescription.textContent = 'Sign in to view your courses';
                        pendingTasks.textContent = '0';
                        tasksDescription.textContent = 'Sign in to view tasks';
                        attendance.textContent = '0%';
                        attendanceDescription.textContent = 'Sign in to view attendance';
                        newMessages.textContent = '0';
                        messagesDescription.textContent = 'Sign in to view messages';
                        
                        // Show sign-in notification
                        showNotification({
                            title: 'Sign In Required',
                            message: 'Please sign in to access your personal dashboard',
                            type: 'warning',
                            duration: 5000
                        });
                    }
                }
            } catch (error) {
                console.error('Initialization error:', error);
                showNotification({
                    title: 'Error',
                    message: 'Failed to initialize dashboard: ' + error.message,
                    type: 'error'
                });
                
                // Fallback to showing the dashboard with sign-in message
                dashboardContent.style.display = 'block';
                
                // Still show Asnat chat in error state
                asnatChat.style.display = 'flex';
            }
        });
    </script>
</body>
</html>