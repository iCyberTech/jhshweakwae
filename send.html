<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Homework Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary-color: #6c5ce7;
            --secondary-color: #a29bfe;
            --text-color: #2d3436;
            --light-text: #636e72;
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
            --success-color: #00b894;
            --danger-color: #d63031;
            --warning-color: #fdcb6e;
            --info-color: #0984e3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 15px;
        }

        .header {
            margin-bottom: 20px;
            text-align: center;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .subtitle {
            font-size: 0.9rem;
            color: var(--light-text);
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-left: 10px;
        }

        .card-icon {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #5649c9;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #00a382;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #c02a2a;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #8a7cff;
        }

        .assignments-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .assignment-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            border: 1px solid var(--glass-border);
            transition: transform 0.3s ease;
        }

        .assignment-card:hover {
            transform: translateY(-5px);
        }

        .assignment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .assignment-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .assignment-icon {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            font-size: 0.9rem;
        }

        .assignment-details {
            margin-top: 12px;
        }

        .assignment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
        }

        .assignment-item:last-child {
            border-bottom: none;
        }

        .assignment-label {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .assignment-value {
            font-size: 0.85rem;
            color: var(--light-text);
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-primary {
            background: rgba(108, 92, 231, 0.1);
            color: var(--primary-color);
        }

        .badge-success {
            background: rgba(0, 184, 148, 0.1);
            color: var(--success-color);
        }

        .badge-warning {
            background: rgba(253, 203, 110, 0.1);
            color: #e17055;
        }

        .submissions-list {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .submission-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .submission-item:last-child {
            border-bottom: none;
        }

        .student-name {
            font-weight: 500;
        }

        .submission-status {
            font-size: 0.85rem;
        }

        .grading-form {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--text-color);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-data {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            margin-top: 15px;
        }

        /* Enhanced Notification Styles */
        .notification {
            padding: 18px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            border-left: 5px solid rgba(255, 255, 255, 0.3);
            align-items: flex-start;
        }

        .notification.success {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.9) 0%, rgba(0, 184, 148, 1) 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, rgba(214, 48, 49, 0.9) 0%, rgba(214, 48, 49, 1) 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, rgba(253, 203, 110, 0.9) 0%, rgba(253, 203, 110, 1) 100%);
            color: #2d3436;
        }

        .notification.info {
            background: linear-gradient(135deg, rgba(9, 132, 227, 0.9) 0%, rgba(9, 132, 227, 1) 100%);
        }

        .notification-icon {
            font-size: 22px;
            margin-right: 15px;
            margin-top: 2px;
            flex-shrink: 0;
        }

        .notification-content {
            line-height: 1.4;
        }

        .notification-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 6px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .notification-message {
            font-size: 0.9rem;
            opacity: 0.95;
            line-height: 1.5;
        }

        .notification-close {
            opacity: 0.7;
            transition: opacity 0.2s ease;
            margin-left: 15px;
            margin-top: 2px;
        }

        .notification-close:hover {
            opacity: 1;
        }

        /* Animation enhancements */
        @keyframes slideIn {
            from {
                transform: translateX(120%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            to {
                transform: translateX(120%);
                opacity: 0;
            }
        }

        .notification.show {
            animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .notification.hide {
            animation: slideOut 0.4s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards;
        }

        .notification-container {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 90%;
            max-width: 350px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Modal Styles */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
        }

        /* MCQ Styles */
        .mcq-container {
            margin-top: 15px;
            border-top: 1px dashed #ddd;
            padding-top: 15px;
        }

        .mcq-toggle {
            background: var(--info-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mcq-toggle:hover {
            background: #0870c4;
        }

        .mcq-form {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .mcq-question {
            margin-bottom: 15px;
        }

        .mcq-options {
            margin-left: 20px;
        }

        .mcq-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .mcq-option input[type="text"] {
            flex: 1;
            margin-left: 8px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .mcq-option input[type="radio"] {
            margin-right: 8px;
        }

        .mcq-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .mcq-list {
            margin-top: 15px;
        }

        .mcq-item {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--info-color);
        }

        .mcq-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .mcq-item-question {
            font-weight: 500;
        }

        .mcq-item-points {
            font-size: 0.85rem;
            color: var(--light-text);
        }

        .mcq-item-options {
            margin-left: 15px;
        }

        .mcq-item-option {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .mcq-item-correct {
            color: var(--success-color);
            font-weight: 600;
            margin-left: 5px;
        }

        .assignment-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .assignment-type-btn {
            padding: 8px 16px;
            border: 1px solid var(--primary-color);
            border-radius: 6px;
            background: white;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .assignment-type-btn.active {
            background: var(--primary-color);
            color: white;
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            .assignments-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .assignment-card {
                padding: 12px;
                border-radius: 10px;
            }
            
            .assignment-name {
                font-size: 0.95rem;
            }
            
            .assignment-icon {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
            
            .assignment-label {
                font-size: 0.9rem;
            }
            
            .assignment-value {
                font-size: 0.8rem;
            }
            
            .notification-container {
                width: 300px;
                top: 10px;
                right: 10px;
            }
            
            .notification {
                padding: 12px 15px;
            }
        }

        @media (max-width: 480px) {
            .assignments-container {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .assignment-card {
                padding: 10px;
            }
            
            .assignment-name {
                font-size: 0.9rem;
            }
            
            .assignment-header {
                margin-bottom: 8px;
            }
            
            .assignment-item {
                padding: 6px 0;
            }
            
            .notification-container {
                width: 280px;
            }
            
            .assignment-type-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Teacher Portal...</div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notification-container"></div>

    <!-- Main Content -->
    <div id="main-content" style="display: none;">
        <div class="header">
            <h1 class="page-title">Homework Management</h1>
            <p class="subtitle">Create assignments and grade student submissions</p>
        </div>

        <div class="container">
            <!-- Create Assignment Section -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-plus"></i>
                    </div>
                    <div class="card-title">Create New Assignment</div>
                </div>
                
                <form id="create-assignment-form">
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <select class="form-control" id="subject-select" required>
                            <option value="">Select a subject</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Class</label>
                        <select class="form-control" id="class-select" required>
                            <option value="">Select a class</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Assignment Title</label>
                        <input type="text" class="form-control" id="assignment-title" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Instructions</label>
                        <textarea class="form-control" id="assignment-instructions" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="datetime-local" class="form-control" id="due-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Maximum Points</label>
                        <input type="number" class="form-control" id="max-points" min="1" value="100" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Assignment Type</label>
                        <div class="assignment-type-selector">
                            <button type="button" class="assignment-type-btn active" data-type="regular">Regular Assignment</button>
                            <button type="button" class="assignment-type-btn" data-type="mcq">Multiple Choice Questions</button>
                        </div>
                    </div>
                    
                    <!-- MCQ Section (Initially Hidden) -->
                    <div id="mcq-container" class="mcq-container" style="display: none;">
                        <button type="button" class="mcq-toggle" id="add-mcq-toggle">
                            <i class="fas fa-plus"></i> Add Multiple Choice Question
                        </button>
                        
                        <div id="mcq-form" class="mcq-form" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Question</label>
                                <input type="text" class="form-control" id="mcq-question">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Options (Mark the correct answer)</label>
                                <div id="mcq-options" class="mcq-options">
                                    <div class="mcq-option">
                                        <input type="radio" name="correct-answer" value="0">
                                        <input type="text" class="form-control" placeholder="Option 1">
                                    </div>
                                    <div class="mcq-option">
                                        <input type="radio" name="correct-answer" value="1">
                                        <input type="text" class="form-control" placeholder="Option 2">
                                    </div>
                                    <div class="mcq-option">
                                        <input type="radio" name="correct-answer" value="2">
                                        <input type="text" class="form-control" placeholder="Option 3">
                                    </div>
                                    <div class="mcq-option">
                                        <input type="radio" name="correct-answer" value="3">
                                        <input type="text" class="form-control" placeholder="Option 4">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Points for this question</label>
                                <input type="number" class="form-control" id="mcq-points" min="1" value="1">
                            </div>
                            
                            <div class="mcq-actions">
                                <button type="button" class="btn btn-success" id="save-mcq">Add Question</button>
                                <button type="button" class="btn btn-secondary" id="cancel-mcq">Cancel</button>
                            </div>
                        </div>
                        
                        <div id="mcq-list" class="mcq-list">
                            <!-- MCQ questions will be added here -->
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Create Assignment</button>
                </form>
            </div>
            
            <!-- Existing Assignments Section -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="card-title">Existing Assignments</div>
                </div>
                
                <div id="assignments-container" class="assignments-container">
                    <!-- Assignments will be dynamically inserted here -->
                </div>
                
                <div id="no-assignments" class="no-data" style="display: none;">
                    <h2>No Assignments Created</h2>
                    <p>You haven't created any assignments yet.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Grading Modal -->
    <div class="modal-backdrop" id="grading-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Grade Submission</h3>
                <button class="modal-close" id="close-grading-modal">&times;</button>
            </div>
            
            <div id="grading-modal-content">
                <!-- Grading form will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Repost MCQ Modal -->
    <div class="modal-backdrop" id="repost-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Repost Multiple Choice Assignment</h3>
                <button class="modal-close" id="close-repost-modal">&times;</button>
            </div>
            
            <div id="repost-modal-content">
                <form id="repost-assignment-form">
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <select class="form-control" id="repost-subject-select" required>
                            <option value="">Select a subject</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Class</label>
                        <select class="form-control" id="repost-class-select" required>
                            <option value="">Select a class</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Assignment Title</label>
                        <input type="text" class="form-control" id="repost-title" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Instructions</label>
                        <textarea class="form-control" id="repost-instructions" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="datetime-local" class="form-control" id="repost-due-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Maximum Points</label>
                        <input type="number" class="form-control" id="repost-max-points" min="1" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Repost Assignment</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
          const firebaseConfig = {
    apiKey: "AIzaSyB5NcC2P3v0LFBVFMp9-mAHQKYuo1pKokA",
    authDomain: "hweakwaecram.firebaseapp.com",
    projectId: "hweakwaecram",
    storageBucket: "hweakwaecram.firebasestorage.app",
    messagingSenderId: "1012181976581",
    appId: "1:1012181976581:web:eee0ad07650b360bc8fe6c",
    measurementId: "G-4GMZJJRVG0"
  };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        
        // DOM Elements
        const loadingScreen = document.getElementById('loading-screen');
        const mainContent = document.getElementById('main-content');
        const notificationContainer = document.getElementById('notification-container');
        const subjectSelect = document.getElementById('subject-select');
        const classSelect = document.getElementById('class-select');
        const createAssignmentForm = document.getElementById('create-assignment-form');
        const assignmentsContainer = document.getElementById('assignments-container');
        const noAssignmentsMessage = document.getElementById('no-assignments');
        const gradingModal = document.getElementById('grading-modal');
        const closeGradingModal = document.getElementById('close-grading-modal');
        const gradingModalContent = document.getElementById('grading-modal-content');
        const repostModal = document.getElementById('repost-modal');
        const closeRepostModal = document.getElementById('close-repost-modal');
        const repostModalContent = document.getElementById('repost-modal-content');
        const repostAssignmentForm = document.getElementById('repost-assignment-form');
        
        // MCQ Elements
        const assignmentTypeButtons = document.querySelectorAll('.assignment-type-btn');
        const mcqContainer = document.getElementById('mcq-container');
        const addMcqToggle = document.getElementById('add-mcq-toggle');
        const mcqForm = document.getElementById('mcq-form');
        const saveMcqBtn = document.getElementById('save-mcq');
        const cancelMcqBtn = document.getElementById('cancel-mcq');
        const mcqList = document.getElementById('mcq-list');
        
        // Firebase references
        const authUsersRef = database.ref('authUsers');
        const teachersRef = database.ref('teachers');
        const subjectsRef = database.ref('subjects');
        const classesRef = database.ref('classes');
        const assignmentsRef = database.ref('assignments');
        const submissionsRef = database.ref('submissions');
        const studentsRef = database.ref('students');
        
        // Global variables
        let currentTeacherId = null;
        let currentTeacherData = null;
        let teacherSubjects = [];
        let teacherClasses = [];
        let assignmentType = 'regular'; // 'regular' or 'mcq'
        let mcqQuestions = [];
        let assignmentToRepost = null;
        
        // Show notification function
        function showNotification({ title, message, type = 'info', duration = 5000 }) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const iconMap = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            
            notification.innerHTML = `
                <i class="fas fa-${iconMap[type]} notification-icon"></i>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close">&times;</button>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Trigger reflow to enable animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto-dismiss after duration
            let timeoutId;
            if (duration > 0) {
                timeoutId = setTimeout(() => {
                    notification.classList.remove('show');
                    notification.classList.add('hide');
                    
                    // Remove after animation completes
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, duration);
            }
            
            // Close button handler
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => {
                clearTimeout(timeoutId);
                notification.classList.remove('show');
                notification.classList.add('hide');
                
                setTimeout(() => {
                    notification.remove();
                }, 300);
            });
            
            return notification;
        }
        
        // Identify the current teacher based on Firebase Auth
        async function identifyCurrentTeacher() {
            return new Promise((resolve, reject) => {
                // Check if user is already signed in
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        try {
                            // User is signed in, get their data from authUsers
                            const authUserSnapshot = await database.ref(`authUsers/${user.uid}`).once('value');
                            
                            if (authUserSnapshot.exists()) {
                                const authUser = authUserSnapshot.val();
                                
                                if (authUser.userType === 'teacher') {
                                    currentTeacherId = authUser.userId;
                                    
                                    // Get teacher details from teachers collection
                                    const teacherSnapshot = await database.ref(`teachers/${currentTeacherId}`).once('value');
                                    
                                    if (teacherSnapshot.exists()) {
                                        currentTeacherData = teacherSnapshot.val();
                                        unsubscribe();
                                        resolve(currentTeacherData);
                                        return;
                                    }
                                }
                            }
                            
                            // If we reach here, the auth user doesn't have proper teacher data
                            unsubscribe();
                            reject(new Error('Teacher data not found for authenticated user'));
                        } catch (error) {
                            unsubscribe();
                            reject(error);
                        }
                    } else {
                        // No user is signed in
                        unsubscribe();
                        reject(new Error('No user is currently signed in'));
                    }
                }, (error) => {
                    unsubscribe();
                    reject(error);
                });
            });
        }
        
        // Load teacher's subjects and classes
        async function loadTeacherData() {
            try {
                // Get all subjects
                const subjectsSnapshot = await subjectsRef.once('value');
                const subjects = subjectsSnapshot.val();
                
                // Get all classes
                const classesSnapshot = await classesRef.once('value');
                const classes = classesSnapshot.val();
                
                if (!subjects || !classes) {
                    showNotification({
                        title: 'Error',
                        message: 'Could not load subjects or classes data',
                        type: 'error'
                    });
                    return;
                }
                
                // Filter subjects assigned to this teacher
                teacherSubjects = [];
                teacherClasses = [];
                
                for (const subjectId in subjects) {
                    const subject = subjects[subjectId];
                    
                    // Check if this teacher is assigned to this subject
                    if (subject.assignments && subject.assignments[currentTeacherId]) {
                        teacherSubjects.push({
                            id: subjectId,
                            name: subject.name,
                            assignments: subject.assignments[currentTeacherId]
                        });
                        
                        // Get classes for this subject
                        if (Array.isArray(subject.assignments[currentTeacherId])) {
                            subject.assignments[currentTeacherId].forEach(assignment => {
                                if (assignment.classId && classes[assignment.classId] && 
                                    !teacherClasses.some(c => c.id === assignment.classId)) {
                                    teacherClasses.push({
                                        id: assignment.classId,
                                        name: classes[assignment.classId].name
                                    });
                                }
                            });
                        } else if (subject.assignments[currentTeacherId].classId && 
                                  classes[subject.assignments[currentTeacherId].classId]) {
                            const classId = subject.assignments[currentTeacherId].classId;
                            if (!teacherClasses.some(c => c.id === classId)) {
                                teacherClasses.push({
                                    id: classId,
                                    name: classes[classId].name
                                });
                            }
                        }
                    }
                }
                
                // Populate subject dropdown
                subjectSelect.innerHTML = '<option value="">Select a subject</option>';
                teacherSubjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.id;
                    option.textContent = subject.name;
                    subjectSelect.appendChild(option);
                });
                
                // Populate class dropdown
                classSelect.innerHTML = '<option value="">Select a class</option>';
                teacherClasses.forEach(classItem => {
                    const option = document.createElement('option');
                    option.value = classItem.id;
                    option.textContent = classItem.name;
                    classSelect.appendChild(option);
                });
                
                // Populate repost modal dropdowns
                const repostSubjectSelect = document.getElementById('repost-subject-select');
                repostSubjectSelect.innerHTML = '<option value="">Select a subject</option>';
                teacherSubjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.id;
                    option.textContent = subject.name;
                    repostSubjectSelect.appendChild(option);
                });
                
                const repostClassSelect = document.getElementById('repost-class-select');
                repostClassSelect.innerHTML = '<option value="">Select a class</option>';
                teacherClasses.forEach(classItem => {
                    const option = document.createElement('option');
                    option.value = classItem.id;
                    option.textContent = classItem.name;
                    repostClassSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error loading teacher data:', error);
                showNotification({
                    title: 'Error',
                    message: 'Failed to load teacher data',
                    type: 'error'
                });
            }
        }
        
        // Load assignments for the current teacher
        async function loadAssignments() {
            try {
                const assignmentsSnapshot = await assignmentsRef.orderByChild('teacherId').equalTo(currentTeacherId).once('value');
                const assignments = assignmentsSnapshot.val();
                
                assignmentsContainer.innerHTML = '';
                
                if (!assignments) {
                    noAssignmentsMessage.style.display = 'block';
                    return;
                }
                
                noAssignmentsMessage.style.display = 'none';
                
                // Convert assignments object to array and sort by creation date (newest first)
                const assignmentsArray = Object.entries(assignments).map(([id, assignment]) => ({
                    id,
                    ...assignment
                })).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                assignmentsArray.forEach(assignment => {
                    const assignmentCard = createAssignmentCard(assignment);
                    assignmentsContainer.appendChild(assignmentCard);
                });
                
            } catch (error) {
                console.error('Error loading assignments:', error);
                showNotification({
                    title: 'Error',
                    message: 'Failed to load assignments',
                    type: 'error'
                });
            }
        }
        
        // Create an assignment card element
        function createAssignmentCard(assignment) {
            const card = document.createElement('div');
            card.className = 'assignment-card';
            
            // Format dates
            const createdAt = new Date(assignment.createdAt).toLocaleDateString();
            const dueDate = new Date(assignment.dueDate).toLocaleDateString();
            
            // Determine status based on due date
            const now = new Date();
            const due = new Date(assignment.dueDate);
            const isOverdue = now > due;
            const status = isOverdue ? 'Overdue' : 'Active';
            
            card.innerHTML = `
                <div class="assignment-header">
                    <div class="assignment-name">${assignment.title}</div>
                    <div class="assignment-icon">${assignment.subjectName ? assignment.subjectName.charAt(0) : 'A'}</div>
                </div>
                
                <div class="assignment-details">
                    <div class="assignment-item">
                        <span class="assignment-label">Subject:</span>
                        <span class="assignment-value">${assignment.subjectName || 'N/A'}</span>
                    </div>
                    
                    <div class="assignment-item">
                        <span class="assignment-label">Class:</span>
                        <span class="assignment-value">${assignment.className || 'N/A'}</span>
                    </div>
                    
                    <div class="assignment-item">
                        <span class="assignment-label">Created:</span>
                        <span class="assignment-value">${createdAt}</span>
                    </div>
                    
                    <div class="assignment-item">
                        <span class="assignment-label">Due:</span>
                        <span class="assignment-value">${dueDate}</span>
                    </div>
                    
                    <div class="assignment-item">
                        <span class="assignment-label">Status:</span>
                        <span class="assignment-value">
                            <span class="badge ${isOverdue ? 'badge-warning' : 'badge-success'}">${status}</span>
                        </span>
                    </div>
                    
                    <div class="assignment-item">
                        <span class="assignment-label">Type:</span>
                        <span class="assignment-value">
                            <span class="badge ${assignment.type === 'mcq' ? 'badge-primary' : 'badge-success'}">
                                ${assignment.type === 'mcq' ? 'Multiple Choice' : 'Regular'}
                            </span>
                        </span>
                    </div>
                    
                    <div class="assignment-item">
                        <span class="assignment-label">Submissions:</span>
                        <span class="assignment-value">${assignment.submissionCount || 0} / ${assignment.studentCount || 0}</span>
                    </div>
                </div>
                
                <div class="assignment-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-primary view-submissions" data-id="${assignment.id}">
                        <i class="fas fa-eye"></i> View Submissions
                    </button>
                    ${assignment.type === 'mcq' ? `
                    <button class="btn btn-secondary repost-mcq" data-id="${assignment.id}">
                        <i class="fas fa-redo"></i> Repost
                    </button>
                    ` : ''}
                </div>
            `;
            
            // Add event listener for view submissions button
            const viewSubmissionsBtn = card.querySelector('.view-submissions');
            viewSubmissionsBtn.addEventListener('click', () => {
                viewSubmissions(assignment);
            });
            
            // Add event listener for repost button if it's an MCQ assignment
            if (assignment.type === 'mcq') {
                const repostBtn = card.querySelector('.repost-mcq');
                repostBtn.addEventListener('click', () => {
                    repostAssignment(assignment);
                });
            }
            
            return card;
        }
        
        // View submissions for an assignment
        async function viewSubmissions(assignment) {
            try {
                // Get all submissions for this assignment
                const submissionsSnapshot = await submissionsRef.orderByChild('assignmentId').equalTo(assignment.id).once('value');
                const submissions = submissionsSnapshot.val();
                
                if (!submissions) {
                    showNotification({
                        title: 'No Submissions',
                        message: 'No submissions found for this assignment',
                        type: 'info'
                    });
                    return;
                }
                
                // Get student data for each submission
                const submissionsWithStudentInfo = [];
                
                for (const submissionId in submissions) {
                    const submission = submissions[submissionId];
                    
                    // Get student info
                    const studentSnapshot = await studentsRef.child(submission.studentId).once('value');
                    const student = studentSnapshot.val();
                    
                    if (student) {
                        submissionsWithStudentInfo.push({
                            id: submissionId,
                            ...submission,
                            studentName: `${student.firstName} ${student.lastName}`,
                            studentEmail: student.email
                        });
                    } else {
                        submissionsWithStudentInfo.push({
                            id: submissionId,
                            ...submission,
                            studentName: 'Unknown Student',
                            studentEmail: 'N/A'
                        });
                    }
                }
                
                // Display submissions in modal
                gradingModalContent.innerHTML = `
                    <h4>Submissions for: ${assignment.title}</h4>
                    <p>Class: ${assignment.className}</p>
                    
                    <div class="submissions-list">
                        ${submissionsWithStudentInfo.map(submission => `
                            <div class="submission-item">
                                <div>
                                    <div class="student-name">${submission.studentName}</div>
                                    <div class="student-email">${submission.studentEmail}</div>
                                </div>
                                <div>
                                    ${submission.graded ? `
                                        <span class="submission-status badge badge-success">Graded: ${submission.score}/${assignment.maxPoints}</span>
                                    ` : `
                                        <span class="submission-status badge badge-warning">Pending</span>
                                        <button class="btn btn-primary grade-submission" data-id="${submission.id}">Grade</button>
                                    `}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                // Add event listeners to grade buttons
                const gradeButtons = gradingModalContent.querySelectorAll('.grade-submission');
                gradeButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const submissionId = button.getAttribute('data-id');
                        const submission = submissionsWithStudentInfo.find(s => s.id === submissionId);
                        showGradingForm(assignment, submission);
                    });
                });
                
                // Show the modal
                gradingModal.style.display = 'flex';
                
            } catch (error) {
                console.error('Error loading submissions:', error);
                showNotification({
                    title: 'Error',
                    message: 'Failed to load submissions',
                    type: 'error'
                });
            }
        }
        
        // Show grading form for a submission
        function showGradingForm(assignment, submission) {
            gradingModalContent.innerHTML = `
                <h4>Grade Submission</h4>
                <p>Student: ${submission.studentName}</p>
                <p>Assignment: ${assignment.title}</p>
                
                <div class="submission-content" style="margin: 15px 0; padding: 15px; background: #f9f9f9; border-radius: 8px;">
                    <h5>Student's Work:</h5>
                    <p>${submission.content || 'No content submitted'}</p>
                </div>
                
                <form id="grade-submission-form">
                    <div class="form-group">
                        <label class="form-label">Score (out of ${assignment.maxPoints})</label>
                        <input type="number" class="form-control" id="submission-score" min="0" max="${assignment.maxPoints}" value="${submission.score || 0}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Feedback</label>
                        <textarea class="form-control" id="submission-feedback" rows="4">${submission.feedback || ''}</textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Submit Grade</button>
                    <button type="button" class="btn btn-secondary" id="back-to-submissions">Back to Submissions</button>
                </form>
            `;
            
            // Handle form submission
            const gradeForm = document.getElementById('grade-submission-form');
            gradeForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const score = parseInt(document.getElementById('submission-score').value);
                const feedback = document.getElementById('submission-feedback').value;
                
                try {
                    // Update submission in database
                    await submissionsRef.child(submission.id).update({
                        score: score,
                        feedback: feedback,
                        graded: true,
                        gradedAt: new Date().toISOString()
                    });
                    
                    showNotification({
                        title: 'Success',
                        message: 'Submission graded successfully',
                        type: 'success'
                    });
                    
                    // Reload the submissions view
                    viewSubmissions(assignment);
                    
                } catch (error) {
                    console.error('Error grading submission:', error);
                    showNotification({
                        title: 'Error',
                        message: 'Failed to grade submission',
                        type: 'error'
                    });
                }
            });
            
            // Handle back button
            const backButton = document.getElementById('back-to-submissions');
            backButton.addEventListener('click', () => {
                viewSubmissions(assignment);
            });
        }
        
        // Repost an MCQ assignment
        function repostAssignment(assignment) {
            assignmentToRepost = assignment;
            
            // Pre-fill the form with the original assignment's data
            document.getElementById('repost-title').value = `${assignment.title} (Repost)`;
            document.getElementById('repost-instructions').value = assignment.instructions;
            document.getElementById('repost-max-points').value = assignment.maxPoints;
            
            // Set the due date to tomorrow by default
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('repost-due-date').value = tomorrow.toISOString().slice(0, 16);
            
            // Show the repost modal
            repostModal.style.display = 'flex';
        }
        
        // Handle assignment type selection
        assignmentTypeButtons.forEach(button => {
            button.addEventListener('click', () => {
                assignmentTypeButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                assignmentType = button.getAttribute('data-type');
                
                if (assignmentType === 'mcq') {
                    mcqContainer.style.display = 'block';
                } else {
                    mcqContainer.style.display = 'none';
                }
            });
        });
        
        // Toggle MCQ form
        addMcqToggle.addEventListener('click', () => {
            if (mcqForm.style.display === 'none') {
                mcqForm.style.display = 'block';
                addMcqToggle.innerHTML = '<i class="fas fa-minus"></i> Cancel Adding Question';
            } else {
                mcqForm.style.display = 'none';
                addMcqToggle.innerHTML = '<i class="fas fa-plus"></i> Add Multiple Choice Question';
            }
        });
        
        // Cancel adding MCQ
        cancelMcqBtn.addEventListener('click', () => {
            mcqForm.style.display = 'none';
            addMcqToggle.innerHTML = '<i class="fas fa-plus"></i> Add Multiple Choice Question';
            
            // Clear form
            document.getElementById('mcq-question').value = '';
            document.querySelectorAll('#mcq-options input[type="text"]').forEach(input => {
                input.value = '';
            });
            document.querySelectorAll('#mcq-options input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });
            document.getElementById('mcq-points').value = '1';
        });
        
        // Save MCQ question
        saveMcqBtn.addEventListener('click', () => {
            const question = document.getElementById('mcq-question').value.trim();
            const points = parseInt(document.getElementById('mcq-points').value);
            
            if (!question) {
                showNotification({
                    title: 'Error',
                    message: 'Please enter a question',
                    type: 'error'
                });
                return;
            }
            
            // Get options
            const optionInputs = document.querySelectorAll('#mcq-options input[type="text"]');
            const options = [];
            let hasEmptyOption = false;
            
            optionInputs.forEach(input => {
                const value = input.value.trim();
                if (!value) {
                    hasEmptyOption = true;
                }
                options.push(value);
            });
            
            if (hasEmptyOption) {
                showNotification({
                    title: 'Error',
                    message: 'Please fill in all options',
                    type: 'error'
                });
                return;
            }
            
            // Get correct answer
            const correctAnswerRadio = document.querySelector('input[name="correct-answer"]:checked');
            if (!correctAnswerRadio) {
                showNotification({
                    title: 'Error',
                    message: 'Please select the correct answer',
                    type: 'error'
                });
                return;
            }
            
            const correctAnswerIndex = parseInt(correctAnswerRadio.value);
            
            // Add question to list
            const mcqId = Date.now(); // Unique ID based on timestamp
            mcqQuestions.push({
                id: mcqId,
                question,
                options,
                correctAnswer: correctAnswerIndex,
                points
            });
            
            // Update MCQ list display
            updateMcqList();
            
            // Reset form
            document.getElementById('mcq-question').value = '';
            optionInputs.forEach(input => {
                input.value = '';
            });
            document.querySelectorAll('#mcq-options input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });
            document.getElementById('mcq-points').value = '1';
            
            showNotification({
                title: 'Success',
                message: 'Question added successfully',
                type: 'success'
            });
        });
        
        // Update MCQ list display
        function updateMcqList() {
            if (mcqQuestions.length === 0) {
                mcqList.innerHTML = '<p>No questions added yet.</p>';
                return;
            }
            
            mcqList.innerHTML = '';
            
            mcqQuestions.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'mcq-item';
                
                questionElement.innerHTML = `
                    <div class="mcq-item-header">
                        <div class="mcq-item-question">${index + 1}. ${q.question}</div>
                        <div class="mcq-item-points">${q.points} point${q.points !== 1 ? 's' : ''}</div>
                    </div>
                    <div class="mcq-item-options">
                        ${q.options.map((option, i) => `
                            <div class="mcq-item-option">
                                ${i === q.correctAnswer ? '<i class="fas fa-check-circle mcq-item-correct"></i>' : '<i class="fas fa-circle"></i>'}
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-danger remove-mcq" data-id="${q.id}" style="margin-top: 10px;">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                `;
                
                mcqList.appendChild(questionElement);
            });
            
            // Add event listeners to remove buttons
            const removeButtons = mcqList.querySelectorAll('.remove-mcq');
            removeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const id = parseInt(button.getAttribute('data-id'));
                    mcqQuestions = mcqQuestions.filter(q => q.id !== id);
                    updateMcqList();
                });
            });
        }
        
        // Initialize the application
        async function initApp() {
            try {
                // Identify the current teacher
                await identifyCurrentTeacher();
                
                // Load teacher's subjects and classes
                await loadTeacherData();
                
                // Load assignments
                await loadAssignments();
                
                // Hide loading screen and show main content
                loadingScreen.style.display = 'none';
                mainContent.style.display = 'block';
                
                showNotification({
                    title: 'Welcome',
                    message: `Hello, ${currentTeacherData.firstName}! Ready to manage your assignments.`,
                    type: 'success'
                });
                
            } catch (error) {
                console.error('Error initializing app:', error);
                loadingScreen.querySelector('.loading-text').textContent = 'Error loading teacher portal. Please refresh the page.';
                
                showNotification({
                    title: 'Error',
                    message: 'Failed to initialize application',
                    type: 'error'
                });
            }
        }
        
        // Event Listeners
        createAssignmentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const subjectId = subjectSelect.value;
            const classId = classSelect.value;
            const title = document.getElementById('assignment-title').value;
            const instructions = document.getElementById('assignment-instructions').value;
            const dueDate = document.getElementById('due-date').value;
            const maxPoints = parseInt(document.getElementById('max-points').value);
            
            if (!subjectId || !classId) {
                showNotification({
                    title: 'Error',
                    message: 'Please select both subject and class',
                    type: 'error'
                });
                return;
            }
            
            // Get subject and class names
            const subjectName = teacherSubjects.find(s => s.id === subjectId)?.name || 'Unknown Subject';
            const className = teacherClasses.find(c => c.id === classId)?.name || 'Unknown Class';
            
            try {
                // Create assignment object
                const assignment = {
                    title,
                    instructions,
                    dueDate: new Date(dueDate).toISOString(),
                    maxPoints,
                    subjectId,
                    classId,
                    subjectName,
                    className,
                    teacherId: currentTeacherId,
                    teacherName: `${currentTeacherData.firstName} ${currentTeacherData.lastName}`,
                    createdAt: new Date().toISOString(),
                    type: assignmentType,
                    status: 'active'
                };
                
                // Add MCQ questions if it's an MCQ assignment
                if (assignmentType === 'mcq') {
                    if (mcqQuestions.length === 0) {
                        showNotification({
                            title: 'Error',
                            message: 'Please add at least one multiple choice question',
                            type: 'error'
                        });
                        return;
                    }
                    
                    assignment.mcqQuestions = mcqQuestions;
                    assignment.totalPoints = mcqQuestions.reduce((sum, q) => sum + q.points, 0);
                }
                
                // Save to database
                const newAssignmentRef = await assignmentsRef.push(assignment);
                
                showNotification({
                    title: 'Success',
                    message: 'Assignment created successfully',
                    type: 'success'
                });
                
                // Reset form
                createAssignmentForm.reset();
                mcqQuestions = [];
                updateMcqList();
                
                if (assignmentType === 'mcq') {
                    mcqForm.style.display = 'none';
                    addMcqToggle.innerHTML = '<i class="fas fa-plus"></i> Add Multiple Choice Question';
                }
                
                // Reload assignments
                await loadAssignments();
                
            } catch (error) {
                console.error('Error creating assignment:', error);
                showNotification({
                    title: 'Error',
                    message: 'Failed to create assignment',
                    type: 'error'
                });
            }
        });
        
        // Handle repost assignment form submission
        repostAssignmentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const subjectId = document.getElementById('repost-subject-select').value;
            const classId = document.getElementById('repost-class-select').value;
            const title = document.getElementById('repost-title').value;
            const instructions = document.getElementById('repost-instructions').value;
            const dueDate = document.getElementById('repost-due-date').value;
            const maxPoints = parseInt(document.getElementById('repost-max-points').value);
            
            if (!subjectId || !classId) {
                showNotification({
                    title: 'Error',
                    message: 'Please select both subject and class',
                    type: 'error'
                });
                return;
            }
            
            // Get subject and class names
            const subjectName = teacherSubjects.find(s => s.id === subjectId)?.name || 'Unknown Subject';
            const className = teacherClasses.find(c => c.id === classId)?.name || 'Unknown Class';
            
            try {
                // Create new assignment based on the original MCQ assignment
                const newAssignment = {
                    title,
                    instructions,
                    dueDate: new Date(dueDate).toISOString(),
                    maxPoints,
                    subjectId,
                    classId,
                    subjectName,
                    className,
                    teacherId: currentTeacherId,
                    teacherName: `${currentTeacherData.firstName} ${currentTeacherData.lastName}`,
                    createdAt: new Date().toISOString(),
                    type: 'mcq',
                    status: 'active',
                    mcqQuestions: assignmentToRepost.mcqQuestions,
                    totalPoints: assignmentToRepost.totalPoints
                };
                
                // Save to database
                await assignmentsRef.push(newAssignment);
                
                showNotification({
                    title: 'Success',
                    message: 'Assignment reposted successfully',
                    type: 'success'
                });
                
                // Close modal
                repostModal.style.display = 'none';
                
                // Reload assignments
                await loadAssignments();
                
            } catch (error) {
                console.error('Error reposting assignment:', error);
                showNotification({
                    title: 'Error',
                    message: 'Failed to repost assignment',
                    type: 'error'
                });
            }
        });
        
        // Close modals
        closeGradingModal.addEventListener('click', () => {
            gradingModal.style.display = 'none';
        });
        
        closeRepostModal.addEventListener('click', () => {
            repostModal.style.display = 'none';
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === gradingModal) {
                gradingModal.style.display = 'none';
            }
            if (e.target === repostModal) {
                repostModal.style.display = 'none';
            }
        });
        
        // Initialize the app when the page loads
        window.addEventListener('load', initApp);
    </script>
</body>
</html>
